CREATE TABLE IF NOT EXISTS game_talisman_stats (
    talisman_id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    rarity TEXT NOT NULL,
    health INTEGER DEFAULT 0,
    defense INTEGER DEFAULT 0,
    strength INTEGER DEFAULT 0,
    crit_chance REAL DEFAULT 0,
    crit_damage REAL DEFAULT 0,
    intelligence INTEGER DEFAULT 0,
    speed INTEGER DEFAULT 0,
    attack_speed INTEGER DEFAULT 0,
    sea_creature_chance REAL DEFAULT 0,
    magic_find REAL DEFAULT 0,
    pet_luck REAL DEFAULT 0,
    ferocity INTEGER DEFAULT 0,
    ability_damage REAL DEFAULT 0,
    true_defense INTEGER DEFAULT 0,
    mining_speed INTEGER DEFAULT 0,
    mining_fortune INTEGER DEFAULT 0,
    farming_fortune INTEGER DEFAULT 0,
    foraging_fortune INTEGER DEFAULT 0,
    fishing_speed INTEGER DEFAULT 0
);

CREATE TABLE IF NOT EXISTS player_bestiary (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    mob_id TEXT NOT NULL,
    kills INTEGER DEFAULT 0,
    deaths INTEGER DEFAULT 0,
    bestiary_level INTEGER DEFAULT 0,
    last_kill_timestamp INTEGER DEFAULT 0,
    FOREIGN KEY (user_id) REFERENCES players(user_id) ON DELETE CASCADE,
    UNIQUE(user_id, mob_id)
);

CREATE TABLE IF NOT EXISTS bestiary_levels (
    mob_id TEXT PRIMARY KEY,
    mob_name TEXT NOT NULL,
    level_1_kills INTEGER DEFAULT 10,
    level_2_kills INTEGER DEFAULT 25,
    level_3_kills INTEGER DEFAULT 50,
    level_4_kills INTEGER DEFAULT 100,
    level_5_kills INTEGER DEFAULT 250,
    level_6_kills INTEGER DEFAULT 500,
    level_7_kills INTEGER DEFAULT 1000,
    level_8_kills INTEGER DEFAULT 2500,
    level_9_kills INTEGER DEFAULT 5000,
    max_level INTEGER DEFAULT 9,
    category TEXT DEFAULT 'general'
);

CREATE TABLE IF NOT EXISTS bestiary_rewards (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    mob_id TEXT NOT NULL,
    level INTEGER NOT NULL,
    reward_type TEXT NOT NULL,
    reward_value REAL DEFAULT 0,
    FOREIGN KEY (mob_id) REFERENCES bestiary_levels(mob_id) ON DELETE CASCADE,
    UNIQUE(mob_id, level, reward_type)
);

CREATE INDEX IF NOT EXISTS idx_player_bestiary_user ON player_bestiary(user_id);
CREATE INDEX IF NOT EXISTS idx_player_bestiary_mob ON player_bestiary(mob_id);
CREATE INDEX IF NOT EXISTS idx_bestiary_rewards_mob ON bestiary_rewards(mob_id);

INSERT OR IGNORE INTO game_talisman_stats (talisman_id, name, rarity, health, strength, crit_damage) VALUES
('speed_talisman', 'Speed Talisman', 'COMMON', 0, 0, 0),
('wood_talisman', 'Wood Affinity Talisman', 'COMMON', 0, 0, 0),
('skeleton_talisman', 'Skeleton Talisman', 'COMMON', 0, 5, 0),
('zombie_talisman', 'Zombie Talisman', 'COMMON', 0, 5, 0),
('village_talisman', 'Village Affinity Talisman', 'COMMON', 5, 0, 0),
('mine_talisman', 'Mine Affinity Talisman', 'COMMON', 5, 0, 0),
('farming_talisman', 'Farming Talisman', 'COMMON', 5, 0, 0),
('bat_talisman', 'Bat Talisman', 'COMMON', 0, 0, 5),
('gravity_talisman', 'Gravity Talisman', 'UNCOMMON', 0, 0, 10),
('piggy_bank', 'Piggy Bank', 'UNCOMMON', 0, 0, 0),
('magnetic_talisman', 'Magnetic Talisman', 'UNCOMMON', 0, 0, 0),
('spider_talisman', 'Spider Talisman', 'UNCOMMON', 0, 10, 0),
('night_vision_charm', 'Night Vision Charm', 'UNCOMMON', 0, 0, 0),
('campfire_talisman', 'Campfire Talisman', 'UNCOMMON', 10, 0, 0),
('red_claw_talisman', 'Red Claw Talisman', 'UNCOMMON', 0, 0, 10),
('ring_of_love', 'Ring of Love', 'RARE', 10, 0, 0),
('feather_talisman', 'Feather Talisman', 'RARE', 0, 0, 0),
('sea_creature_talisman', 'Sea Creature Talisman', 'RARE', 0, 0, 0),
('potion_affinity_talisman', 'Potion Affinity Talisman', 'RARE', 0, 0, 0),
('scavenger_talisman', 'Scavenger Talisman', 'RARE', 0, 0, 0),
('wolf_paw', 'Wolf Paw', 'RARE', 0, 15, 15),
('lynx_talisman', 'Lynx Talisman', 'RARE', 0, 10, 10),
('wolf_talisman', 'Wolf Talisman', 'EPIC', 0, 20, 20),
('zombie_ring', 'Zombie Ring', 'EPIC', 0, 15, 0),
('skeleton_ring', 'Skeleton Ring', 'EPIC', 0, 15, 0),
('intimidation_talisman', 'Intimidation Talisman', 'EPIC', 0, 0, 0),
('candy_talisman', 'Candy Talisman', 'EPIC', 15, 5, 5),
('ender_artifact', 'Ender Artifact', 'EPIC', 20, 20, 0),
('tarantula_talisman', 'Tarantula Talisman', 'EPIC', 0, 20, 20),
('spider_artifact', 'Spider Artifact', 'LEGENDARY', 0, 25, 30),
('bat_artifact', 'Bat Artifact', 'LEGENDARY', 0, 0, 30),
('red_claw_artifact', 'Red Claw Artifact', 'LEGENDARY', 0, 0, 44);

INSERT OR IGNORE INTO bestiary_levels (mob_id, mob_name, category) VALUES
('zombie', 'Zombie', 'hub'),
('skeleton', 'Skeleton', 'hub'),
('spider', 'Spider', 'hub'),
('lapis_zombie', 'Lapis Zombie', 'hub'),
('cave_spider', 'Cave Spider', 'spiders_den'),
('spider_jockey', 'Spider Jockey', 'spiders_den'),
('broodfather', 'Broodfather', 'spiders_den'),
('blaze', 'Blaze', 'crimson_isle'),
('magma_cube', 'Magma Cube', 'crimson_isle'),
('wither_skeleton', 'Wither Skeleton', 'crimson_isle'),
('enderman', 'Enderman', 'end'),
('zealot', 'Zealot', 'end'),
('ender_dragon', 'Ender Dragon', 'end'),
('ghast', 'Ghast', 'nether'),
('piglin_brute', 'Piglin Brute', 'nether'),
('wither', 'Wither', 'nether'),
('redstone_pigman', 'Redstone Pigman', 'deep_caverns'),
('emerald_slime', 'Emerald Slime', 'deep_caverns');

INSERT OR IGNORE INTO bestiary_rewards (mob_id, level, reward_type, reward_value) VALUES
('zombie', 1, 'health', 2),
('zombie', 2, 'health', 4),
('zombie', 3, 'health', 6),
('zombie', 4, 'strength', 2),
('zombie', 5, 'strength', 4),
('zombie', 6, 'defense', 2),
('zombie', 7, 'defense', 4),
('zombie', 8, 'crit_damage', 5),
('zombie', 9, 'crit_damage', 10),
('skeleton', 1, 'crit_chance', 1),
('skeleton', 2, 'crit_chance', 2),
('skeleton', 3, 'crit_damage', 5),
('skeleton', 4, 'crit_damage', 10),
('skeleton', 5, 'strength', 3),
('skeleton', 6, 'strength', 5),
('skeleton', 7, 'defense', 3),
('skeleton', 8, 'health', 10),
('skeleton', 9, 'health', 20),
('spider', 1, 'speed', 1),
('spider', 2, 'speed', 2),
('spider', 3, 'crit_chance', 2),
('spider', 4, 'crit_chance', 3),
('spider', 5, 'strength', 4),
('spider', 6, 'defense', 4),
('spider', 7, 'health', 12),
('spider', 8, 'crit_damage', 8),
('spider', 9, 'crit_damage', 15),
('enderman', 1, 'intelligence', 5),
('enderman', 2, 'intelligence', 10),
('enderman', 3, 'strength', 5),
('enderman', 4, 'strength', 10),
('enderman', 5, 'health', 20),
('enderman', 6, 'defense', 10),
('enderman', 7, 'crit_damage', 15),
('enderman', 8, 'magic_find', 5),
('enderman', 9, 'magic_find', 10),
('blaze', 1, 'strength', 3),
('blaze', 2, 'strength', 6),
('blaze', 3, 'health', 15),
('blaze', 4, 'defense', 5),
('blaze', 5, 'crit_damage', 12),
('blaze', 6, 'crit_chance', 3),
('blaze', 7, 'intelligence', 8),
('blaze', 8, 'ability_damage', 5),
('blaze', 9, 'ability_damage', 10);
